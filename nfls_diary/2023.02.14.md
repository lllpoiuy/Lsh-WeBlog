###     [AGC057C] Increment or Xor  

> 给定正整数 $N$，以及一个长度为 $2^N$ 的序列，$A=A_0,A_1,\cdots,A_{2^N-1}$。满足每个数都是 $[0,2^N-1]$ 里的整数，且**互不相同**。每次你可以对序列进行两种操作：
>
> - 操作一：**每个数**加一，再对 $2^N$ 取模。
>
> - 操作二：选取一个 $[0,2^N-1]$ 中的整数 $x$，**每个数**异或上 $x$。
>
> 最终要使得 $\forall i,A_i=i$。输出方案或报告无解。可以证明，若有解，一定能在 $10^6$ 次操作内实现。可以给出任意合法方案，但你给出的方案不应超过 $10^6$ 次操作。若有解，输出中有一行整数依次描述你的每次操作：输出 $-1$ 表示该次你选择操作一；输出 $[0,2^N-1]$ 中的一个整数 $x$ 表示你选择用它进行操作二。
>

首先这题的做法非常的构造性。首先我们考虑 SPJ 怎么写的，这肯定是个 trie，bit reverse 后：

- 异或相当于把某一层的全部儿子翻转。
- +1 相当于把最右边的一整条链翻转，事实上也可以做到翻转任一叶子节点上方的所有结点。

对于每个点，记录它被翻转了几次和目标翻转几次，我们从下向上递归构造就好。

### 【北大集训2021】末日魔法少女计划

> ![](./p43.png)

首先这是一道理论数据结构题。

我们设 $f_{x,i}$ 表示 $x$ 个数的区间，要求任一区间都得在 $i$ 步以内达成，那么我们枚举它分成了 $m$ 段，中间的 $m-2$ 段都需要前缀和和后缀和，第一段只要前缀和，最后一段只要后缀和；然后对于整段的和，可以用 $f_{m-2,i-2}$ 解决。

### 【北大集训2021】简单数据结构

> ![](./p44.png)

考虑这个取 $\min$ 操作的影响怎么合并，设当前进行了 $t$ 次操作二，$v_i$ 表示 $i$ 次操作二时最小的 $v$，令 $a'_i=a_i-it$，那么 $a'_i=\min_j\left\{ v_j-ij \right\}$，也就是和一个下凸包取 $\min$。每次给下凸包新增一条斜率递减的直线，然后找到所有和它相交的点，把它删掉。拿线段树套 Splay 维护凸包，来求凸包和某个斜率的切线和删点即可。

### Everybody Lost Somebody

>![](./p45.png)

对于 $ht(a,c)$ 已知，那么就是连 $s_{a,b}=s_{c,d}$ 这样的区间相同的边，然后连一条小于号的边；如果 $ht(i,j)=-1$，那么比较 $rk_{i+1},rk_{j+1}$，若 $rk_{i+1}<rk_{j+1}$，那就连小于等于的边；否则连小于的边。

为了优化连边，那么可以用分层并查集维护；也可以考虑其性质，对于 $ht>0$，我们依然考虑 $ht(i+1,j+1)$，只需要连一条 $i-j$ 的边就够了；$ht$ 从大到小扫一遍就好了。$O(n\log n)\sim O(n)$。

### Upside Down

> 给出一棵 $n$ 个节点的树，每一条边上有一个小写字母。给定 $m$ 个字符串 $s$。
>
> 有 $q$ 组询问，每组询问包含三个数：$i,j,k$，表示如下询问：
>
> 以从 $i$ 到 $j$ 的路径上每一条边的字母连接起来所构成的字符串为文本串，$s_k$ 为模式串，求 $s_k$ 在文本串中出现的次数。$n,q\le 10^5$。

考虑 $u-lca-v$ 这条链，$u-lca$ 的部分显然，$v-lca$ 的部分也显然；难在于跨过去的部分。

实际上，也就要求 $u-lca$ 的一个后缀，恰好是 $s_k$ 的前缀；$lca-v$ 的一个前缀，恰好是 $s_k$ 的后缀，然后拼起来是 $s_k$。假如求出 $u-lca$ 最长的一个后缀 $W$，那么 $W$ 的所有 border 也就构成了 $u-lca$ 的后缀 $\cap$ $s_k$ 的前缀。而 border 是 $\log$ 个等差数列，可以 $q\log^2$ 求。

抽象一下求 $|W|$ 的问题：给定 $S$ 和 $T$，求最长的 $S$ 的后缀恰好是 $T$ 的前缀：

<img src="./p46.png" style="zoom:67%;" />

我们求出 $\max\operatorname{lcp}(S[i,|S|),T)$，那么 $W$ 是这个 $lcp$ 的一个 border。怎么求 $lcp$？可以把 $S$ 后缀排序了，然后二分 $T$ 在 $S$ 中的排名就好了。

### Almost Multiplication Table

> ![](./p47.png)

我们二分一个 $D$，设 $[L_{i,j},R_{i,j}]$ 表示 $x_iy_j$ 必须处在的范围。一开始，令 $x_i=i,y_j=10^9+D+j$，也就是分别是 $x$ 能取到的最小值，$y$ 能取到的最大值，我们反复迭代直到找到答案：
$$
y_j\leftarrow \min\left(y_{j+1}-1,\left\lfloor\frac{R_{i,j}}{x_i}\right\rfloor\right)\\
x_i\leftarrow \min\left(x_{i-1}+1\left\lceil\frac{L_{i,j}}{y_j}\right\rceil\right)\\
$$
正确性显然，因为求的都是必要条件，而最后满足条件时就很充分！复杂度 $nm(n+m)\cdot V^{0.5}\cdot \log V$。

使用条件？二分图吧。