### [朝日](http://www.nfls.com.cn:10611/contest/700/problem/1)

> 你打了如下形式的一场表：``vector>ans={{2},{3},{2,2},{5},{2,3},{3,3},{2,2,2},{7},{2,5},{2,2,3},{3,5},{2,3,3},{2,2,2,2},{2,7},{2,2,5},{3,3,3},{2,2,2,3}...``
>
> 其中和为第一关键字，个数为第二关键字，字典序为第三关键字；请输出其 $[l,r]$ 内的所有字母。$r-l+1\le 10^7,1\le l,r\le 10^{18}$。

首先只有 $750$ 以内的 $135$ 个素数是有用的。设 $f/g_{i,j,k}$ 表示 $i\sim 135$ 个素数、选了 $j$ 个、和为 $k$ 的方案数；然后枚举长度和总和，像线段树那样爆搜下去输出。复杂度是正确的。

### [露娜](http://www.nfls.com.cn:10611/contest/700/problem/2)

> 有一个无限长的整数序列 $X$，每个元素都是从 $[1, m]$ 中等概率地随机 选取的，求序列 $B$ 在 $X$ 中的第一次出现位置的期望。$n,m\le 2\times 10^5$。

首先用可持久化线段树建出 kmp 自动机；这个东西一开始肯定觉得是解方程或者矩阵求逆之类的东西，但是要做到这个数据范围，这个方程肯定是有一定方向的。

设 $g_i$ 表示当前在结点 $i$，期望多少步走到结点 $n$；那么方程为：
$$
g_i=1+\frac 1m\left(g_{i+1}+\sum_{}g_{\mathrm{return}_x}\right)
$$
那么反过来，就可以解出 $g_{i+1}$ 来。设 $g_0=x$，可以用可持久化线段树快速地求出所有的 $g=kx+b$，最后解个方程就行了。

### Oppa Funcan Style Remastered

> 给定 $n, k$，求是否能将 $n$ 分解为 $n = \sum q_i$ 使得 $1 < q_i$，$q_i |k$，$n \le 10^{18}$，$k \le 10^{15}$。$T ≤ 10000$，只有不超过 $50$ 个不同的 $k$。

质因数分解然后，判定无穷背包可达性，这是经典的同余最短路的应用场景。

### Geometric Progressions

> 有 $n$ 个等比数列 $\left\{a_i , a_ib_i , a_ib_i^2,\cdots \right\}$，求最小的在所有等比数列中都出现的数 $\bmod 10^9 + 7$ 后的值，或判断不存在。 $n \le 100, a_i , b_i \le 10^9$。

首先质因数分解。

考虑单个质因数，此质因数在每个等比数列中的次数，构成一个等差数列或者单点。

若此质因数全都是单点，那么判所有单点是否相等，不相同无解，相等的话可以丢掉。

若此质因数一部分是等差数列，一部分是单点，那么判定一下这个单点是否出现在其它的等差数列中，若出现的话，就直到是第几项了，也就知道了其具体的值。

若全都是等差数列怎么办？

我们可以看作是高维空间里的一些射线，然后射线求交，这就简单了，若存在两个射线在某一维上斜率不相等，则可以直接求出交点来并判断；否则所有的都在一个斜率上，直接 `exCRT` 合并某一个维度上的限制即可。

### [CF1770F] Koxia and Sequence

> 给定 $n, x, y$。对于所有满足 $a_1 + a2 + \cdots + a_n = x, a_1|a_2 | \cdots |a_n = y$ 的 $a$，求 $a_1 \oplus a_2 \cdots \oplus a_n$ 的异或和。$n < 2^{40},x<2^{60},y < 2^{20}$。

考虑可重排列方案数的奇偶性和 Lucas 定理，所有的 $a$ 的出现次数都得是 $n$ 的子集，于是 $n$ 为偶数时答案为 $0$；$n$ 为奇数的时候，只需要考虑 $a_1$ 的异或和即可。

再枚举 $a_1$ 的某一位 $i$，计算 $2^i\in a_1$ 的方案数。由于恰好或起来为 $y$ 的限制肯定没法做，容斥 $y$ 的哪些位是空的（$2^{20}$），方案数也就是一个背包：
$$
\sum_{\sum a_i=x-2^i}[a_1\subseteq y'-2^i]\cdot\prod_{i=2}^n [a_i\subseteq y']
$$
惊世骇俗的一步：逆用 Lucas 定理并使用范德蒙德卷积，所以这个式子就等于：
$$
[ny'-2^i\subseteq x-2^i]
$$
这个逆用 Lucas 的用途实际上应该很广泛。

### 

