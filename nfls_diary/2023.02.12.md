### Replace

> 给定一个长为 $n$ 的序列 $a_1,\ldots,a_n$，其中对于任意的 $i$ 满足 $1 \leq a_i \leq n$。
>
> 定义一个二元组函数如下：
> $$f((l,r))=(\min\{a_l,\ldots,a_r\},\max\{a_l,\ldots,a_r\})(l \leq r)$$
>
> 你需要回答 $q$ 次询问，每次给定 $(l_i,r_i)$，问其最少经过多少次 $f$ 的调用（即 $(l,r) \rightarrow f((l,r))$）使得 $(l_i,r_i)$ 变成 $(1,n)$，若无解请输出 `-1`。$n,q\le 2\times 10^5$。

首先 $f(l,r)=\cup_{i\in[l,r)} f(i,i+1)$，设 $f_{k,i}$ 表示 $2^k$ 步后 $(i,i+1)$ 能走到哪里，直接 rmq 在 $f_{k-1}$ 上查询就能转移。

### Summation By Construction

>![](./p41.png)

虽然但是，场切铜牌题，好帅啊。

对于 $n$ 是奇数，$n+1$ 就是偶数！所以我们提取其 $\frac {n+1}2$ 条轨道：

```
x x
  x x
    x x
      x x
```

这样的轨道长度为 $n$，所以我们可以将其分成 $i$ 和 $n-i$ 两部分。

对于 $n$ 是偶数，我们考虑这样一些轨道：

```
x       x x 
x x       x
  x x
    x x
      x x
```

这个轨道可以放下两个数 $i,n+1-i$，但是问题在于 $n$ 的这个会成环，我们在右上角上交换一下就好。

### First Come First Serve

> ![](./p42.png)

对于一种方案，我们把所有右括号改成左括号不影响方案的右括号都改成左括号，这样得出的结果我猜和不同的方案一一对应，充分性显然，必要性我看着就对吧。然后容斥一个括号集合，它选了右括号，并且左括号到右括号之间没有任何别的括号。而一个容斥元素会控制一个区间，我们求出每个括号对控制的区间，然后从左往右 dp 就好了。