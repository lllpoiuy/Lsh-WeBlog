见到了 Alex_Wei。他没我高，真是太菜了（这是 Marsrayd 建议我写的，不代表本人立场）。

### 魔术师 (card)

> 有一副牌，正反两面都有数，各是一个排列。你要任意排列，使得正面排列和反面排列的最大公共子串最大是多少。$T\le 100,n\le 2000$。

首先公共子串形如：

```
     1    2    3    4
1    2    3    4
```

容易发现这些是同一个置换环上的一条链。我们求出所有的置换环，并且尝试把它们分成一些链，并拼起来。

玩一玩发现，任意个长度为 $i$ 和 $i+1$ 的链可以拼起来。所以我们枚举这个 $i$，然后枚举所有置换环的长度，再枚举有多少个 $i$，求出有多少个 $i+1$，贡献进答案里。由于不同的置换环长度只有 $O(n^{0.5})$ 种，所以总复杂度就是 $O(Tn^{1.5}\ln n)$ 或者 $O(n^2\ln n+Tn\ln n)$。

### 只会心疼割割 (giegie)

> ![](./p9.png)
>
> $n\le 5000,q\le 300$。

首先满足这个性质的图有几个性质：

1. 只有一个强连通分量。
2. 任意两点间的最短路小于等于 $3$。
3. 等价于，可以到达一个点的所有点可以构成一个全序集，有一个【gie 树】的构造方法，我不会！！！

对于这道题，我们不妨在任意竞赛图上做这道题。最小割也就是：
$$
cut(u,v)=\min_{S,u\in S, v\not\in S} \sum_{(x,y)\in E} [x\in S, y\not\in S]
$$
我们考虑 $cost(S)\rightarrow cost(S\cup\{k\})$ 的变化量（设为 $w_k$）：
$$
w_k=\sum_{x\not\in S,x\not=k}[(k,x)\in E]-\sum_{x\in S} [(x,k)\in E]
$$
再考虑 $S\rightarrow S\cup \{k\}$ 后 $w_i$ 的变化量：
$$
\begin{aligned}
w_i&=....\\
&=w_i-1
\end{aligned}
$$
竟然和具体 $S$ 的取值无关，所以只要先把 $w$ 排好序就能够快速查询了。

### [递增树列](https://qoj.ac/contest/1085/problem/5367)

> 给定一棵 $n$ 个点的有根树，问排列 $p$ 的数量，使得 $\forall i,\operatorname{dep}(\operatorname{lca}(p_i,i_{i-1}))\le \operatorname{dep}(\operatorname{lca}(p_i,i_{i+1}))$。$n\le 80$。

首先我们把序列反过来变成递减，不难发现 $lca$ 序列是逐渐走向根的一条链的子集。设 $f_{u,i}$ 表示最终 $lca$ 在 $u$ 子树内、剩下 $i$ 个点没有走的方案数，合并的话，限制条件就是不能连续走进同一个子树里，可以容斥，容斥完每个子树就是独立的，只有它分成了几段是有用的，我们用 EGF 相乘来统计即可。

### [异世界的文章分割者](https://qoj.ac/contest/1085/problem/5368)

二分，然后对于每个 $l$，贪心找到最大的 $r$；并且对于每个 $l,r$，维护出 $F(l,r)$。这个当然可以用数据结构来解决。更简单的办法是，考虑单个序列的 $F$ 的计算，可以在后缀树上 dp 解决。而这个问题，我们可以倍增，然后二分，来规约到单个 $F$ 的计算。

### [Matrix](https://qoj.ac/contest/1086/problem/5371)

首先 $B$ 的每行的和都是相等的，每列的和也都是相等的，否则无解。

我们把行看作是左部点，列看作是右部点，那么 $B_{i,j}$ 就是 $i,j$ 的边的容量，这是一张 $K$ 正则图，我们只要找到它的一个边染色就做完了。

