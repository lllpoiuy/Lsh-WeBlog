### Puzzle: X-Sums Sudoku

> ![](./p20.png)

直接找规律：
$$
A_{x=2^na+b,y=2^mc+d}=(a\oplus d)+2^m\cdot(b\oplus c)
$$
显然 $+$ 的两边是独立的，行和列的求和是对称的。而对于一列的前缀求和，$c,d$ 固定。

1. $a\oplus d$ 的部分：
   1. 对于 $A_{x=2^m e+f,y}(e<a)$ 的部分：每个的 $f$ 都是 $2^n$ 种，直接算就好 $\sum_{i=0}^a (i\oplus d)$ 就好，这个可以直接枚举 $i$ 的自由位来算。
   2. 否则，单独算一下就好。
2. $b\oplus c$ 的部分：
   1. 对于 $A_{x=2^me+f,y}(e<a)$ 的部分，每个 $f$ 对应的 $e$ 都是有 $a$ 种，相当于把 $c$ 的后 $n$ 位变成任意的，求和。
   2. 否则，贡献系数都是 $1$，依然是转成算 $\sum_{i=0}^a(i\oplus d)$。

复杂度 $O(n+m)$。

### puzzle: Patrick’s Parabox

> ![](./p21.png)

我们直接记 $(u,0/1/2/3)$，表示箱子在 $u$，人在 $u$ 四个方向的哪个连通块里。考虑怎么连边，一种是推箱子的边，一种是绕到了另一个连通块里的边。第二种边怎么连？用圆方树判断一下就好了。对于飞走的边，可以用树形 dp 判一下。

### Puzzle: Hearthstone

> ![](./p22.png)

我们记下每个 add 可能对应的集合，不难发现，时间越晚集合越大，构成一个杨图的结构。必选就等价于它上方的 add 数量等于其候选集合大小；不可选就意味着它在最新的 add 中都不可能。

用一个线段树维护候选集合大小减上方 add 数量，维护其最靠后的 = 0 的位置，就是最严格的必选的限制。

用一个数组维护每个牌的最大的禁止时间 $time$（也就是杨图这一列的高度）。

用一个树状数组维护时间上哪些位置有 add，用于快速求上方的 add 的数量；用一个并查集维护一个时间后最新的 add，能够帮助我们定位 add。

`add` 操作时：新增一行就好。如果当前所有牌都必选，那么就 bug。

`test x 1` 时：找到 $time_x$ 下方第一个 add，然后删这个 add，显然是影响最小的。

`test x 0` 时：若这个 $x$ 是否是必选的，bug；否则，更新这一列的 $time$，并且更新线段树。

复杂度 $O(q\log n)$。

### 「ICPC World Finals 2021」蛛网漫游

> 蜘蛛 Charlotte 位于她的蜘蛛网的中心，蜘蛛网由一系列丝质直线组成，这些直线都是从中心延伸到网的外部边界。Charlotte 的网也有桥，每个桥都连接着相邻的两根线。桥的两个端点到蜘蛛网中心的距离总是一样的。
>
> 当 Charlotte 在网的中心吃完了深夜的大餐，想要退到某个角落时，她会自动走到边缘。要做到这一点，她会选择一根起始线并沿着它走，直到她遇到该线上的第一座桥。她会通过这座桥，走到另一条线上，然后一直向外走，直到她遇到另一座桥。然后她会通过那座桥，重复这个过程，直到当前的线上不再有桥，然后她会走到当前线的尽头。请注意，Charlotte 必须通过她所遇到的所有桥。图 I.1 展示了 Charlotte 可能经过的一条路径。
>
> Charlotte 白天最喜欢睡觉的角落是在线 $s$ 的末端。对于每条可能的起始线，她想知道为了在 $s$ 处结束，需要在原网上增加的桥的最少数量。Charlotte 可以在线上的任何一点增加一个桥，只要增加的桥不接触任何其他的桥。任何增加的桥的两个端点到蜘蛛网中心的距离必须相同，而且该桥必须连接相邻的两根线。$3\le n\le 200\ 000$。

我们从上到下 dp，相当于两两相差不能超过 $1$，一条必须的边就是交换两个 dp 值。数据结构维护一下就好。