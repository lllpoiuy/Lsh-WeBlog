### 倍数 (multi)

> 幸运人认为 $B$ 进制下各位数字不同的数是幸运数字。 给定 $n$ 和 $B$，求 $n$ 倍数中是幸运数字的第二大是多少。若不存在输出 $-1$。$B\le 12,n\le 10^{18}$。

首先幸运数字最大只有 $10^{13}$ 左右。

若 $n>10^5$，直接枚举 $n$ 的倍数；分段打表即可 $O(1)$ 判断一个数是否幸运。

若 $n\le 10^5$，考虑状压 dp，设 $f_S=set$ 表示 $S$ 集合里的数能够拼出模数为多少的数，bitset 优化 dp，然后 `dfs` 输出方案即可。

### 玉米加农炮 (cannon)

> 咸鱼人喜欢玩植物大战僵尸。他把游戏的场地抽象为了 $nm$ 的网格，并在其中 $K$ 个位置放置了玉米加农炮。每
> 个加农炮有一个能量值 $w$，它仅可以向与它所在位置曼哈顿距离不超过 $w$ 的位置发射玉米。第 $t$ 秒 $w=t$，$t$ 从 $0$ 开始。
> 咸鱼人可以做的操作是在每秒选择一个加农炮，向一个未被发射过的位置发射玉米。一个位置是在第 $i$ 秒被发射到的，就会被标记上 $i$。同一个加农炮可以多次使用，但一次只能使用一个。已经有加农炮的位置也需要被发射玉米。
> 咸鱼人发现不管如何操作，每次都存在未被发射过的位置在可以被发射到的范围内。因此，在第 $nm$ 秒结束以后，他根据每个位置上标的数字得到了一个 $0,\cdots,nm$ 的排列。他想知道，可以得到多少种不同的排列。输出这个答案除以 $nm$ 在模 $2.5\times 10^9+1$ 意义下的结果。
> $\sum n,\sum m\le 10^7,\sum K\le 2000$。

对每个格子求出 $\mathrm{Hold}_i$ 表示离它最近的加农炮的曼哈顿距离，那么限制就是 $p_i\ge \mathrm{Hold}_i$。将 $\mathrm{Hold}$ 从小到大排序后，方案数就是 $\prod_i \left(nm-\mathrm{Hold}_i-i\right)$。设 $\mathrm{cnt}_i$ 等于 $i$ 的数的个数，$S_i$ 表示大于 $i$ 的数的个数，那么答案就是：
$$
\begin{aligned}
\mathrm{Ans}&=\frac{1}{(nm)!}\cdot\prod_i \left(nm-i-S_i\right)^{\underline{cnt_i}}\\
&=\prod_{i=0}^{n+m-1}\frac{nm-i-S_i}{nm-i}
\end{aligned}
$$
所以我们尝试直接求出 $\mathrm{cnt}_i$ 数组。部分分做法是扫描线，并根据每个加农炮到扫描线的距离确定其控制的区间。

正解是，离散化，找到 $O(K^2)$ 的网格，对于网格上的点跑出答案，网格的边上的答案也好跑，网格的格子里的点的最近距离肯定先经过其四角，也好考虑。

### 图 (graph)

> 给定一张 $n$ 个点，$m$ 条边的无向图，保证无重边自环，对于任意一条边 $u, v(u < v)$，都有 $v − u = A$ 或 $v − u = B$，求这张图的合法匹配数，$\bmod 998244353$。定义匹配是一个边的子集，且满足端点不交。$n\le 200$。

把这张图改写成网格图的样子，$i$ 放在 $\left(\left\lfloor\frac iB\right\rfloor, \frac iA\bmod B\right)$。

那么 $i\rightarrow i+B$ 就是 $(x,y)\rightarrow(x+1,y)$，$i\rightarrow i+A$ 也就是 $(i,j+1)$ 或者 $(i+1,j+1)$，直接在这个网格图上轮廓线 dp 就好。总复杂度是 $2^B$ 和 $2^{2\frac {n}{B}}$ 平衡得到 $2^{2\sqrt n}$。

### [agc057e] RowCol/ColRow Sort

首先考虑只有 `01` 怎么做，实际上就行和列分别进行一个可重排列即可。对应的方案是唯一的（由于**杨图的性质**），比如说：

```
   3  2  1  1
2  x  x  x  x
1  x  x
4  x
```

以行为例，选择最大的行，此时一定有恰好它这么多列非零：

```
    1  2  3  1
 2  
 1 
 4  x  x  x  x
```

然后再选择最大的行：

```
    0  1  2  0
 2     x  x  
 1 
 4  x  x  x  x
```

我们考虑依次在 $0$ 里面选出一些 $1$，$1$ 里面选出一些 $2$，……方案数相乘即可。

比如 $1$ 长这样，我们要从中选出一些 $2$：

```
  1  1  1  1
  1  1
  1
```

假如每列有 $a_i$ 个 $2$，每行有 $b_i$ 个 $2$，那么我们就是要找到 $a,b$ 的一个置换，使得：根据杨图的构造方式，不会有 $0$ 被改成 $2$。比如上述情况的第四列，若 $a_4=1$，结果 $b_3=3$，那么 $(3,4)$ 就会被弄成 $2$，这是不可接受的。

设 $p_j$ 为 第 $j$ 多的列，那么最后它等于 $0$ 的行的 $b_i<j$。我们从右向左填 $a$，设 $f_{i,j}$ 表示从右向左到了第 $i$ 列，最小值为 $j$ 的方案数，计算 $b$ 的填法的方案数就是跟今天第二题一样的，$\prod(a_i-i+1)$ 即可。