### 模拟退火

> ![](./p53.png)
>
> $n\le 10^5$。

显然每一层是独立的，我们把每一层分别提取出来一个虚树并 dp 就好了。

### 可以通过

> ![](./p54.png)
>
> $n\le 10^5$。

坐标系翻转 $45^{\circ}$，横坐标相同或者纵坐标相同的点之间可以匹配。每个横坐标、纵坐标分别建一个虚点，每个点当作一条边，连起对应的两个虚点，那么我们就是要把边两两配对（两两之间有公共端点）。

如果是一个树，那么可以从叶子向上构造，边数是偶数一定有解；如果是图，那么随便提一个生成树，非树边随便连到一个端点上，依然有解。

### 大样例

> ![](./p55.png)
>
> $n\le 10^5$。

设 $f_{i,j}$ 表示 $i$ 子树内有 $j$ 个点的最大收益，那么增益函数是一个 $j(k-j)$，肯定是凸的，可以在 splay 上维护一次函数 tag。而闵可夫斯基和也是很容易通过启发式合并维护。

### [AGC018F] Two Trees

> 给定两棵都是$N$个节点的有根树$A,B$，节点均从$1..N$标号。
>
> 我们需要给每个标号定一个权值，使在两棵树上均满足任意节点子树权值和为$1$或$-1$
>
> 输出任意一种解，需要判断无解。$N\leqslant 100000$。

首先我们可以判定每个点的奇偶性，两棵树上对应点的奇偶性不同则无解。我们建两张图，分别是着两棵树，两张图的对应点之间右边当且仅当这个点是奇数，然后跑一个欧拉回路，一个点是 $+1$ 当且仅当它是左向右的边，否则是 $-1$，偶数则定为 $0$，就满足条件了。

