### CF1654G Snowy Mountain

> * 给定一棵 $n$ 个点的树，其中每个点可能是黑色或白色。
> * 一个点的高度定义为其距离最近黑色节点的距离。
> * 你初始在 $i$ 号节点上，势能为 $0$，可以做以下两种操作：
> * 向高度更小的相邻节点移动，增加 $1$ 的势能。
> * 向高度相同的相邻节点移动，减少 $1$ 的势能，这个操作只能在你的势能 $\geq 1$ 时执行。
> * 对于 $i=1,2,\cdots, n$，求出你能做的操作数的最大值。
> * $n\leq 2\times 10^5$。

如果遇到一个平台，则可以在上面反复横跳，使得势能减小到 $0$，然后接着走完（一定可以向下走）。

策略上：走一条路径，使得经过的最低的平台最低（此时一定可以在这个平台上清空已有势能，所以答案只和经过的最后一个平台有关）。

一个暴力是：从一个点出发 bfs，找到它出发能到的最低的平台。但是，不同的平台高度只有 $\sqrt{n}$ 种，可以反过来，从每种高度的平台出发开始 bfs。

### 货币

> $n$ 个国家按照顺序排成一行，有 $m$ 次事件，第 $i$ 次事件代表国家 $(u,v)$ 的货币可以流通。
>
> 请选择一个最短的连续区间 $[l,r]$，使得按照顺序访问 $[l,r]$ 的国家之后可以搜集所有种类的货币。$1≤n≤10^5,1≤m≤2⋅10^5$，强制在线。

一个想法是设 $nxt_{i,c}$ 表示 $i$ 之后的颜色 $c$ 的第一个出现位置，设 $f_l=\max_c nxt_{l,c}$，那么答案就是 $\min f_l-l+1$。但是这个 $nxt$ 涉及的修改面过广，有没有修改位置能少的办法？

设 $nxt_0$ 表示 $f_1$，$nxt_i$ 表示 $i$ 之后第一个和 $i$ 相同的颜色的位置，那么：$f_l=\max_{i<l} nxt_i$。由于启发式合并，$nxt$ 只会被修改 $O(n\log n)$ 次。

$f$ 是递增的，一次 $nxt_i$ 被修改，只会影响到一个区间，这个区间里的所有 $f=nxt_i$。那么这个区间会被分裂为若干个小连续段，可以在线段树上二分找到这些连续段。由于每次只会合并 $O(1)$ 个连续段，所以势能总的上升空间只有 $nxt$ 修改次数级别，也就是 $O(n\log n)$ 的。总复杂度 $O(n\log ^2 n)$。

### Eclipse

> ![](./p62.png)
>
> $n\le 30,a,b\le 10^8$。

多元函数求最值有一个**调整法**：固定除了一个变量之外的所有变量，剩下一个一元函数求最值的问题。

考虑 $x$，固定 $c,y$：$x$ 一定在 $|a_i-c_ix|$ 的一个零点上，整数化后就是某一个 $\left\lfloor\frac {a_i}c\right\rfloor$ 或者 $\left\lceil\frac {a_i}c\right\rceil$，一共只有 $V^{0.5}$。

考虑 $c_i$，固定 $x,y$：这是两个折一次函数相加，主要肯定在斜率更大的那一个。不妨设 $x>y$，那么 $c_i$ 为 $\left\lfloor\frac {a_i}x\right\rfloor$ 或者 $\left\lceil\frac {a_i}x\right\rceil$，具体是哪一个可以列出一个不等式。

那么我们枚举 $x$，然后对于每个 $i$，将 $y$ 的取值分成 $O(1)$ 段，每一段确定是选 $c_i=\left\lfloor\frac {a_i}x\right\rfloor$ 或者 $\left\lceil\frac {a_i}x\right\rceil$，那么一共有 $O(n)$ 段，对于每一段分别求个最值即可。

### Covering The Range

> ![](./p63.png)
>
> $n,m\le 3000$。

首先可以转化成如下的 dp：
$$
f_{i,j}=\sum_{k<i}f_{k,j-calc(k,i)}
$$
这个可以插值，对于每个点值，用区间乘法的线段树就行了。

