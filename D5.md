### D5.T1 [CodeForces - 1411G](https://vjudge.net/problem/CodeForces-1411G/origin)

#### 题意：

> 有个 $n$ 个点 $m$ 条边的有向无环图。
>
> 每次在范围 $[1, n+1]$ 内随机一个整数 $v$，如果 $v≤n$ 则在结点 $v$ 上放一个石子，否则停止这个过程。
>
> 过程结束后，两人在这个 `DAG` 上玩组合游戏，每次选一个石子向出边移动，不能移动者输。
>
> 问先手赢的概率。**数据范围：$1 ≤ n ≤ 100000$，$0 ≤ m ≤ 100000$。**

#### 题解：

我们可以轻松预处理出每个点的 `SG` 值，那么总的 `SG` 值就是选出的点的 `SG` 值的异或值，题目就转化为了求这些点的异或值为 $0$ 的概率。 

设 $f(S)$ 表示当前局面是 $S$ 时先手失败的概率，则 $f(S)=\frac 1{r_S}(\sum p_T\cdot f(T))+\frac 1{n+1}[S=0]$，高斯消元即可。

考虑更快的做法，定义一种新的幂级数——集合幂级数 $f(z)=\sum F_X\cdot z^X$，定义它的运算为：
$$
f(z)+g(z)=\sum_X(F_X+G_X)\cdot z^X,\ \ \ f(z)\times g(z)=\sum_{X,Y}(F_X\cdot G_X)\cdot z^{X\bigoplus Y}
$$
实际上我们也可以用 `FMT` 和内积来定义它的乘法。那么怎么在这题中使用呢？

设 $f(z)=\sum_X \frac{cnt_X}{n+1}z^X$，那么答案的生成函数就是：
$$
\frac{1}{n+1}\left(1+f+f^2+f^3+\cdots\right)=\frac 1n\cdot\frac{1}{1-f}
$$
大力求逆就行了。怎么求逆呢？考虑到集合幂级数相对于形式幂集数的特有的性质——有限环，那么我们把它 `FMT` 一下，每一位分别对于除法取反，最后转回来。

复杂度：$N+\sqrt N\log N$，评测链接：[**AC Submission**](https://www.luogu.com.cn/record/47348493)。

### D5.T2 [CodeForces - 1458D](https://vjudge.net/problem/CodeForces-1458D/origin)

#### 题意：

> 有个 `01` 串 $s$。你可以选择一段 $0$ 和 $1$ 个数相同的子串，然后把它 `reverse` 了，再把它其中的 $0$ 变成 $1$，$1$ 变成 $0$。这个操作可以执行任意多次。求可以获得的字典序最小的 $s$。**数据范围：$1 ≤ |s| ≤ 500000$。**

#### 题解：

**相同的个数 -> 自然能够想到一个 Trick**，把 $0$ 替换成 $-1$，求出前缀和为 $s_i$，那么翻转一定是在相同的 $s$ 间翻转。

考虑图论建图，在点之间连双向边，翻转相当于从环的另一边绕回来，跑最小字典序欧拉路径即可。

时间复杂度：$O(n)$，评测链接：[**AC Submission**](https://codeforces.com/contest/1458/submission/108785696)。

### D3.T3 [CodeForces - 1458E](https://vjudge.net/problem/CodeForces-1458E/origin)

#### 题意：

> 新 Nim 游戏是一个**两堆石子**的 Nim 游戏，但是多了 n 个必败态。
>
> 分别用 $(x_1, y_1)$，$(x_2, y_2)$ 一直到 $(x_n, y_n)$ 表示。其中 $(x_i, y_i)$  就表示了当第一堆石子的数量为 $x_i$ 且第二堆石子的数量为 $y_i$  时，就不能执行任何操作了，也就是这是个必败态。注意石子数量是有序的，如果第一堆石子数量为 $y_i$ 且第二堆为  $x_i$，那么不算必败态（除非有另一个 $(y_i, x_i)$ 的必败态）。
>
> 然后再给 $m$ 个询问 $(a_i, b_i)$，你需要回答当第一堆石子为 $a_i$ 个且第二堆石子为 $b_i$ 个时是必胜还是必败，如果必胜输出 `WIN` 否则输出 `LOSE`。
>
> **数据范围：$1 ≤ n, m ≤ 100000$，$0 ≤ x_i, y_i, a_i, b_i ≤ 10^9$。**

